<div class="container-fluid">

  <div class="row scrollable-row" cdkDropListGroup>
    <div class="col-12 d-flex">
      <div class="card-column me-3" *ngFor="let stageType of stageTypes">
        <div class="card">
          <!-- header -->
          <div class="card-header bg-white">
            <div class="d-flex flex-column">
              <h4 class="card-title d-flex p-2 text-nowrap" style="margin: 0;">{{ stageType.name }}</h4>
              <div class="d-flex flex-wrap align-items-center text-muted ">
                <span class="p-2">$ {{ dealsValueByStageId[stageType.id] | number : '1.2-2' }}</span>
                <span class="p-2">{{ dealsByStageId[stageType.id].length }} Deal</span>
                <span class="p-2">{{ dealsProbabilityByStageId[stageType.id] }}%</span>
              </div>
            </div>
          </div>

          <div cdkDropList class="example-list" [cdkDropListData]="dealsByStageId[stageType.id]"
            (cdkDropListDropped)="drop($event)" style="background-color: rgb(240, 240, 240);">
            <div class="col" *ngFor="let deal of dealsByStageId[stageType.id]" cdkDrag>
              <div class="example-custom-placeholder" *cdkDragPlaceholder></div>
              <app-pipeline-view-card [cardData]="deal"></app-pipeline-view-card>
            </div>
          </div>

          <div class="text-center d-grid">
            <button class="btn btn-primary" (click)="addModal(addContent)"><i class="mdi mdi-plus me-1"></i>
              Add New</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Modal -->
  <ng-template #addContent role="document" let-modal>
    <div class="modal-header">
      <h5 class="modal-title mt-0">Add Deal</h5>
      <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
      <form>
        <div class="form-group row mb-3">
          <label for="formDealTitleInput" class="col-sm-2 col-form-label">Title</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="formDealTitleInput" placeholder="Enter deal title">
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formDescriptionInput" class="col-sm-2 col-form-label">Description</label>
          <div class="col-sm-10">
            <textarea class="form-control text-muted" id="formDescriptionInput" rows="3"
              placeholder="Enter description"></textarea>
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formLeadTypeInput" class="col-sm-2 col-form-label text-nowrap">Lead Type</label>
          <div class="col-sm-10 d-flex align-items-center">
            <div class="form-check form-check-inline" *ngFor="let lead of leadTypes">
              <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1"
                checked>
              <label class="form-check-label" for="inlineRadio1">{{ lead }}</label>
            </div>
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formLeadTypeInput" class="col-sm-2 col-form-label text-nowrap">Person</label>
          <div class="col-sm-10 d-flex align-items-center">
            <mat-select [formControl]="personCtrl" placeholder="Person">
              <mat-option>
                <ngx-mat-select-search [formControl]="personFilterCtrl" placeholderLabel="Search"
                  noEntriesFoundLabel="Didnt match anything"></ngx-mat-select-search>
              </mat-option>
              <mat-option *ngFor="let person of filteredPerson | async" [value]="person">
                {{person.name}}
              </mat-option>
            </mat-select>
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formDealValueInput" class="col-sm-2 col-form-label">Deal Value</label>
          <div class="col-sm-10">
            <input type="number" class="form-control" id="formDealValueInput" placeholder="Enter Deal Value">
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formLeadTypeInput" class="col-sm-2 col-form-label text-nowrap">Pipeline</label>
          <div class="col-sm-10 d-flex align-items-center">
            <select class="form-select">
              <option *ngFor="let pipelineOption of pipeline">{{ pipelineOption.name }}</option>
            </select>
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formStageTypeInput" class="col-sm-2 col-form-label text-nowrap">Stage</label>
          <div class="col-sm-10 d-flex align-items-center">
            <select class="form-select">
              <option *ngFor="let stage of stageTypes">{{ stage.name }}</option>
            </select>
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formExpClosingDateInput" class="col-sm-2 col-form-label">Expecting Closing Date</label>
          <div class="col-sm-10 d-flex align-items-center">
            <input class="form-control" type="date" id="formExpClosingDateInput">
          </div>
        </div>
        <div class="form-group row mb-3">
          <label for="formLeadTypeInput" class="col-sm-2 col-form-label text-nowrap">Owner</label>
          <div class="col-sm-10 d-flex align-items-center">
            <select class="form-select">
              <option *ngFor="let user of userData">
                {{ user.fullName }}
              </option>
            </select>
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-light" (click)="modal.close('Close click')">Cancel</button>
      <button type="button" class="btn btn-primary">Save</button>
    </div>
  </ng-template>